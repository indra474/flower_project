{% extends "shop/base.html" %}
{% load static %}

{% block content %}

<div class="cart-box">
    <h2>üõí Your Cart</h2>

    {% if cart_items %}

    <form method="POST" action="{% url 'checkout' %}" onsubmit="return validateSelection();">
    {% csrf_token %}

        {% for item in cart_items %}
        <div class="cart-item"
             style="display:flex; align-items:center; justify-content:space-between;
                    padding:10px; border-bottom:1px solid #ddd; gap:15px;">

            <!-- ‚úÖ SELECT -->
            <div>
                <input type="checkbox" name="selected_items" value="{{ item.id }}">
            </div>

            <!-- üñº IMAGE -->
            <div>
                {% if item.flower.image %}
                    <img src="{{ item.flower.image.url }}"
                         style="width:80px; height:80px; object-fit:cover; border-radius:6px;">
                {% else %}
                    <img src="{% static 'shop/no-image.png' %}"
                         style="width:80px; height:80px; object-fit:cover; border-radius:6px;">
                {% endif %}
            </div>

            <!-- üå∏ PRODUCT -->
            <div style="width:30%;">
                <strong>{{ item.flower.name }}</strong><br>
                <small>Price: ¬•{{ item.flower.price }}</small>
            </div>

            <!-- üî¢ QTY -->
            <div>
                Qty: {{ item.quantity }} <br>
                <strong>¬•{{ item.total_price }}</strong>
            </div>

            <!-- üóë DELETE -->
            <div>
                <a href="{% url 'remove_from_cart' item.flower.id %}"
                   style="color:red; text-decoration:none; font-size:18px;">
                   üóë
                </a>
            </div>

        </div>
        {% endfor %}

        <hr>
        <h3>Total: ¬•{{ total }}</h3>

        <div style="display:flex; gap:15px; margin-top:20px;">

            <!-- üõç CONTINUE SHOPPING -->
            <a href="{% url 'flowers' %}" class="btn" style="background:#007bff;">
                ‚ûï Continue Shopping
            </a>

            <!-- üí≥ CHECKOUT -->
            <button type="submit" class="btn" style="background:#28a745;">
                Checkout Selected Items
            </button>

        </div>

    </form>

    {% else %}
        <p>Your cart is empty üå∏</p>
        <a href="{% url 'flowers' %}" class="btn">Go Shopping</a>
    {% endif %}
</div>

<script>
function validateSelection() {
    let checkboxes = document.querySelectorAll('input[name="selected_items"]:checked');

    if (checkboxes.length === 0) {
        alert("‚ö†Ô∏è Please select at least one item to checkout.");
        return false;
    }
    return true;
}
</script>

{% endblock %}
